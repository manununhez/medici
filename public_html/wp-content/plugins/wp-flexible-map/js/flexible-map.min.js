// Flexible Map
// https://flexible-map.webaware.net.au/

window.FlexibleMap=function(){"use strict";var e,t,i,r,o,n,a=!1;this.getMap=function(){return e},this.getCenter=function(){return t},this.setCenter=function(i){t=i,e.setCenter(t)},this.setMarkerLocation=function(e){i=e},this.getMarkerLocation=function(){return i},this.setMarkerPoint=function(e){r=e},this.getMarkerPoint=function(){return r},this.setMarkerInfowin=function(e){o=e},this.getMarkerInfowin=function(){return o},this.getKmlLayer=function(){return n},this.redrawOnce=function(){a||(a=!0,this.redraw())},this.showMap=function(i,r){t=new google.maps.LatLng(r[0],r[1]);var o,n={small:google.maps.ZoomControlStyle.SMALL,large:google.maps.ZoomControlStyle.LARGE,default:google.maps.ZoomControlStyle.DEFAULT},a=n.small;return this.zoomControlStyle in n&&(a=n[this.zoomControlStyle]),o={mapTypeId:this.mapTypeId,mapTypeControl:this.mapTypeControl,scaleControl:this.scaleControl,panControl:this.panControl,streetViewControl:this.streetViewControl,zoomControl:this.zoomControl,zoomControlOptions:{style:a},draggable:this.draggable,disableDoubleClickZoom:!this.dblclickZoom,scrollwheel:this.scrollwheel,center:t,zoom:this.zoom},this.mapTypeIds&&(o.mapTypeControlOptions={mapTypeIds:this.mapTypeIds.split(",")}),e=new google.maps.Map(document.getElementById(i),o),this.mapTypeId in this.mapTypes&&e.mapTypes.set(this.mapTypeId,this.mapTypes[this.mapTypeId]._styled_map),e},this.loadKmlMap=function(i){return n=new google.maps.KmlLayer({map:e,url:i}),google.maps.event.addListenerOnce(n,"defaultviewport_changed",function(){t=n.getDefaultViewport().getCenter()}),n},!this.localised&&"flxmap"in window&&this.localise(),this.mapTypeId=google.maps.MapTypeId.ROADMAP,this.mapTypeControl=!0,this.scaleControl=!1,this.panControl=!1,this.zoomControl=!0,this.zoomControlStyle="small",this.streetViewControl=!1,this.scrollwheel=!1,this.draggable=!0,this.dblclickZoom=!0,this.zoom=16,this.markerTitle="",this.markerDescription="",this.markerHTML="",this.markerLink="",this.markerLinkTarget="",this.markerLinkText=!1,this.markerIcon="",this.markerShowInfo=!0,this.markerDirections=!1,this.markerDirectionsShow=!1,this.markerDirectionsDefault="",this.markerAddress="",this.targetFix=!0,this.dirService=!1,this.dirRenderer=!1,this.dirDraggable=!1,this.dirSuppressMarkers=!1,this.dirShowSteps=!0,this.dirShowSearch=!0,this.dirTravelMode="driving",this.dirUnitSystem=void 0,this.region="",this.locale="en",this.localeActive=!1,this.kmlcache="none"},FlexibleMap.prototype=function(){"use strict";var e,t,i;document.addEventListener?(e=function(e,t,i){e.addEventListener(t,i,!1)},t=function(e){e.stopPropagation(),e.preventDefault()}):document.attachEvent&&(e=function(e,t,i){e.attachEvent("on"+t,function(){i.call(e,window.event)})},t=function(e){e.cancelBubble=!0,e.returnValue=0}),i="undefined"!=typeof MutationObserver?function(e,t){var i=document.getElementById(t).parentNode;function r(e){var t=window.getComputedStyle(e);return"none"===t.display||"hidden"===t.visibility}r(i)&&new MutationObserver(function(t,o){r(i)||(e.redrawOnce(),o.disconnect())}).observe(i,{attributes:!0,attributeFilter:["style"]})}:function(){};var r=function(){function e(e){var t=e.charCodeAt(0),i=t.toString(16);return t<256?"\\x"+("00"+i).slice(-2):"\\u"+("0000"+i).slice(-4)}return function(t){return t.replace(/[\\/"'&<>\x00-\x1f\x7f-\xa0\u2000-\u200f\u2028-\u202f]/g,e)}}();return{constructor:FlexibleMap,i18n:{},mapTypes:{},localised:!1,localise:function(){var e,t;if("i18n"in flxmap&&(FlexibleMap.prototype.i18n=flxmap.i18n),"mapTypes"in flxmap){t=flxmap.mapTypes;for(e in t)t[e]._styled_map=new google.maps.StyledMapType(t[e].styles,t[e].options);FlexibleMap.prototype.mapTypes=t}FlexibleMap.prototype.localised=!0},setlocale:function(e){return this.locale=e,e in this.i18n?this.localeActive=e:e.substr(0,2)in this.i18n?this.localeActive=e:this.localeActive=!1,this.localeActive},gettext:function(e){var t=this.localeActive;return t&&e in this.i18n[t]?this.i18n[t][e]:e},showKML:function(o,n,a){void 0!==a&&(this.zoom=a);var s=this,l=document.getElementById(o),c=l.getAttribute("data-flxmap"),d=this.showMap(o,[0,0]),m=this.loadKmlMap(function(e,t){var i,r,o,n=/^(\d+)\s*(minute|hour|day)s?$/.exec(t);if(n){switch(i=(new Date).getTime(),o=+n[1],n[2]){case"minute":o<5&&(o=5),r=i/(6e4*o);break;case"hour":r=i/(36e5*o);break;case"day":r=i/(864e5*o);break;default:r=!1}r&&(r=Math.floor(r),e+=(e.indexOf("?")>-1?"&":"?")+"nocache="+r)}return e}(n,this.kmlcache));i(this,o),void 0!==a&&google.maps.event.addListenerOnce(d,"zoom_changed",function(){d.setZoom(a),s.zoom=a}),(this.markerDirections||this.markerDirectionsShow)&&this.startDirService(d),google.maps.event.addListener(m,"click",function(e){var t=e.featureData;if(!t._flxmapOnce){if(t._flxmapOnce=!0,s.targetFix&&t.description){var i=/ target="_blank"/gi;t.description=t.description.replace(i,""),t.infoWindowHtml=t.infoWindowHtml.replace(i,"")}if(s.markerDirections){var o=e.latLng,n=o.lat()+","+o.lng()+",'"+r(t.name)+"',true",a='<br /><a href="#" data-flxmap-fix-opera="1" onclick="'+c+".showDirections("+n+'); return false;">'+s.gettext("Directions")+"</a>";t.infoWindowHtml=t.infoWindowHtml.replace(/<\/div><\/div>$/i,a+"</div></div>")}}}),window.opera&&this.markerDirections&&e(l,"click",function(e){e.target.getAttribute("data-flxmap-fix-opera")&&t(e)})},showMarker:function(r,o,n){var a=this.showMap(r,o),s=new google.maps.LatLng(n[0],n[1]),l=new google.maps.Marker({map:a,position:s,icon:this.markerIcon});if(this.setMarkerPoint(l),this.setMarkerLocation(s),i(this,r),this.markerTitle||(this.markerTitle=this.markerAddress),this.markerTitle||this.markerHTML||this.markerDescription||this.markerLink||this.markerDirections){var c,d,m,h,p,u,g=this,f=document.createElement("DIV");if(f.className="flxmap-infowin",(p=document.createElement("DIV")).className="flxmap-marker-title",this.markerTitle&&(p.appendChild(document.createTextNode(this.markerTitle)),l.setTitle(this.markerTitle)),f.appendChild(p),this.markerHTML&&((p=document.createElement("DIV")).innerHTML=this.markerHTML,f.appendChild(p)),this.markerDescription||this.markerLink){if((p=document.createElement("DIV")).className="flxmap-marker-link",this.markerDescription){for(c=0,d=(m=this.markerDescription.split("\n")).length;c<d;c++)c>0&&p.appendChild(document.createElement("BR")),p.appendChild(document.createTextNode(m[c]));this.markerLink&&p.appendChild(document.createElement("BR"))}this.markerLink&&((u=document.createElement("A")).href=this.markerLink,this.markerLinkTarget&&(u.target=this.markerLinkTarget),u.appendChild(document.createTextNode(this.markerLinkText||this.gettext("Click for details"))),p.appendChild(u)),f.appendChild(p)}this.markerDirections&&((p=document.createElement("DIV")).className="flxmap-directions-link",(u=document.createElement("A")).href="#",u.dataLatitude=n[0],u.dataLongitude=n[1],e(u,"click",function(e){t(e),g.showDirections(this.dataLatitude,this.dataLongitude,!0)}),u.appendChild(document.createTextNode(this.gettext("Directions"))),p.appendChild(u),f.appendChild(p)),h=new google.maps.InfoWindow({content:f}),this.setMarkerInfowin(h),this.markerShowInfo&&google.maps.event.addListenerOnce(a,"tilesloaded",function(){h.open(a,l)}),google.maps.event.addListener(l,"click",function(){h.open(a,l)});var k=function(){g.updateGoogleLink()};google.maps.event.addListener(a,"idle",k),google.maps.event.addListener(a,"center_changed",k),google.maps.event.addListenerOnce(a,"tilesloaded",k)}(this.markerDirections||this.markerDirectionsShow)&&(this.startDirService(a),this.markerDirectionsShow&&this.showDirections(n[0],n[1],!1))},showAddress:function(e,t){var i=this,r=new google.maps.Geocoder;this.markerAddress=t,""===this.markerTitle&&(this.markerTitle=t),r.geocode({address:t,region:this.region},function(t,r){if(r===google.maps.GeocoderStatus.OK){var o=t[0].geometry.location,n=[o.lat(),o.lng()];i.showMarker(e,n,n)}else window.alert("Map address returns error: "+r)})},updateGoogleLink:function(){if("querySelectorAll"in document)try{for(var e=this.getMap().getDiv(),t=this.getMarkerLocation(),i=e.querySelectorAll("a[href*='maps.google.com/maps']:not([href*='mps_dialog']):not([href*='&q='])"),r=0,o=i.length,n=encodeURIComponent((this.markerAddress?this.markerAddress:this.markerTitle)+" @"+t.lat()+","+t.lng());r<o;r++)i[r].href+="&mrt=loc&iwloc=A&q="+n}catch(e){}},redraw:function(){var e=this.getMap(),t=this.getKmlLayer();if(google.maps.event.trigger(e,"resize"),t)e.fitBounds(t.getDefaultViewport());else{e.setCenter(this.getCenter()),e.setZoom(this.zoom);var i=this.getMarkerInfowin();i&&i.open(e,this.getMarkerPoint())}},startDirService:function(e){this.dirService||(this.dirService=new google.maps.DirectionsService),this.dirRenderer||(this.dirRenderer=new google.maps.DirectionsRenderer({map:e,draggable:this.dirDraggable,suppressMarkers:this.dirSuppressMarkers,panel:this.dirShowSteps?document.getElementById(this.markerDirectionsDiv):null}))},showDirections:function(i,r,o){var n=this;function a(e){var t={origin:e,destination:""===n.markerAddress?new google.maps.LatLng(i,r):n.markerAddress};switch(n.region&&(t.region=n.region),n.dirTravelMode){case"bicycling":t.travelMode=google.maps.TravelMode.BICYCLING;break;case"driving":t.travelMode=google.maps.TravelMode.DRIVING;break;case"transit":t.travelMode=google.maps.TravelMode.TRANSIT;break;case"walking":t.travelMode=google.maps.TravelMode.WALKING}switch(n.dirUnitSystem){case"imperial":t.unitSystem=google.maps.UnitSystem.IMPERIAL;break;case"metric":t.unitSystem=google.maps.UnitSystem.METRIC}n.dirService.route(t,s)}function s(e,t){var i=google.maps.DirectionsStatus;switch(t){case i.OK:n.dirRenderer.setDirections(e);break;case i.ZERO_RESULTS:window.alert("No route could be found between the origin and destination.");break;case i.OVER_QUERY_LIMIT:window.alert("The webpage has gone over the requests limit in too short a period of time.");break;case i.REQUEST_DENIED:window.alert("The webpage is not allowed to use the directions service.");break;case i.INVALID_REQUEST:window.alert("Invalid directions request.");break;case i.NOT_FOUND:window.alert("Origin or destination was not found.");break;default:window.alert("A directions request could not be processed due to a server error. The request may succeed if you try again.")}}this.markerDirectionsDiv&&this.dirShowSearch&&function(){var i,r,s,l=document.getElementById(n.markerDirectionsDiv),c=document.createElement("form");for(r=l.lastChild;r;r=l.lastChild)l.removeChild(r);(r=document.createElement("p")).appendChild(document.createTextNode(n.gettext("From")+": ")),(s=document.createElement("input")).type="text",s.name="from",s.value=n.markerDirectionsDefault,r.appendChild(s),(i=document.createElement("input")).type="submit",i.value=n.gettext("Get directions"),r.appendChild(i),c.appendChild(r),l.appendChild(c),void 0===c.elements.from&&(c.elements.from=s),o&&s.focus(),e(c,"submit",function(e){t(e);var i=this.elements.from.value;/\S/.test(i)&&a(i)})}(),this.markerDirectionsDefault&&a(this.markerDirectionsDefault)}}}();